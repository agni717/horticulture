<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Hq_Dashboard extends HQ_Controller {
	
	 public function __construct() {
        parent::__construct();

        //$this->data["u_details"] = $this->admin_m->GetDetailsofUsers($this->session->userdata['uid']);
        
    }
	
	public function index() {
	//$scheme_id = $this->uri->segment(3);
	$param_data = array();
		
	if($_POST)
	{
		$scheme_id = $this->input->post("scheme_id");
		$scheme_status_name = $this->input->post("scheme_status_name");
		$scheme_status_value = $this->input->post("scheme_status_value");
		
		$this->form_validation->set_rules('apl_status', 'Select Status', 'required|trim');
		
		if($this->form_validation->run() == TRUE)
		{
			//$data['list'] = '';
			//echo 123; die;
			$status = $this->input->post("apl_status");
			
			if($status == 2){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_applicant_submitted'=>2);
				}else{
					$param_data = array('is_applicant_submitted'=>2);
				}

			}else if($status == 1){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_applicant_submitted'=>1);
				}else{
					$param_data = array('is_applicant_submitted'=>1);
				}
				
			}else if($status == 3){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_district_app_reject_revert'=>1);
				}else{
					$param_data = array('is_district_app_reject_revert'=>1);
				}
				
			}else if($status == 4){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_district_app_reject_revert'=>2);
				}else{
					$param_data = array('is_district_app_reject_revert'=>2);
				}
				
			}else if($status == 5){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_district_app_reject_revert'=>3);
				}else{
					$param_data = array('is_district_app_reject_revert'=>3);
				}
				
			}else if($status == 6){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_hq_app_reject_revert'=>1);
				}else{
					$param_data = array('is_hq_app_reject_revert'=>1);
				}
				
			}else if($status == 7){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_hq_app_reject_revert'=>2);
				}else{
					$param_data = array('is_hq_app_reject_revert'=>2);
				}
				
			}else if($status == 8){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_hq_app_reject_revert'=>3);
				}else{
					$param_data = array('is_hq_app_reject_revert'=>3);
				}
				
			}else if($status == 9){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_first_sanction'=>1);
				}else{
					$param_data = array('is_first_sanction'=>1);
				}
				
			}else if($status == 10){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'apply_for_1st_installment_release'=>1);
				}else{
					$param_data = array('apply_for_1st_installment_release'=>1);
				}
				
			}else if($status == 11){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_dist_approve_1st_installment_release'=>1);
				}else{
					$param_data = array('is_dist_approve_1st_installment_release'=>1);
				}
				
			}else if($status == 12){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'first_installment_released_by_HQ'=>1);
				}else{
					$param_data = array('first_installment_released_by_HQ'=>1);
				}
				
			}else if($status == 13){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'apply_for_second_installment'=>1);
				}else{
					$param_data = array('apply_for_second_installment'=>1);
				}
				
			}else if($status == 14){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'is_dist_approve_2nd_installment_release'=>1);
				}else{
					$param_data = array('is_dist_approve_2nd_installment_release'=>1);
				}
				
			}else if($status == 15){
				if($scheme_id !=''){
					$param_data = array('scheme_id'=>$scheme_id,'second_installment_released_by_HQ'=>1);
				}else{
					$param_data = array('second_installment_released_by_HQ'=>1);
				}
				
			}			
			
			//$this->data['list'] = $list = $this->admin_m->get_App_list($row, $this->data['dist_code']);
			$this->data['list'] = $list = $this->admin_m->get_application_list($param_data);
			
			//echo '<pre>'; print_r($list); die();

			
		}else{
					
			$this->data['src_disable'] = TRUE;
			if($scheme_id !=''){
				$param_data = array('scheme_id'=>$scheme_id,$scheme_status_name=>$scheme_status_value);
			}else{
				$param_data = array($scheme_status_name=>$scheme_status_value);
			}
			$this->data['list'] = $list = $this->admin_m->get_application_list($param_data);
		}
	}else{
		$param_data = array('is_applicant_submitted'=>2);
		//$this->data['list'] = $list = $this->admin_m->get_App_list($row, $this->data['dist_code']);
		$this->data['list'] = $list = $this->admin_m->get_application_list($param_data);
		//echo '<pre>'; print_r($list); die();
	}
	
	if($list != false){
	foreach($list as $dt){
			if($dt->is_applicant_submitted == 2){
				$this->data['controller'] = 'citizen_form_details/';
			}
		}
	}
		
        $this->load->view('admin/dashboard', $this->data);
    }
    
		
	//Active Scheme List Function Start
	public function active_scheme()
	{
		$data['scheme_data'] = $this->scheme_m->get_schemes();
		$this->load->view('headquater/active_scheme_list',$data);
	}

 		
	public function hq_total_application_list()
	{
		$scheme_id = $this->uri->segment(4);
		$is_applicant_submitted = '2'; //1=saved,2=submitted
		$param_data = array('scheme_id'=>$scheme_id,'is_applicant_submitted'=>$is_applicant_submitted);
		$data['list']=$this->scheme_m->get_application_list($param_data);
		/*echo '<pre>';
		print_r($data['list']);
		die();*/
		$this->load->view('headquater/hq_total_application_list',$data);
	}
	
	public function dist_approved_application_list_in_hq()
	{
		$scheme_id = $this->uri->segment(4);

		$is_district_app_reject_revert = '1'; //approved
		$param_data = array('scheme_id'=>$scheme_id,'is_district_app_reject_revert'=>$is_district_app_reject_revert);

		$data['list']=$this->scheme_m->get_application_list($param_data);
		$this->load->view('headquater/dist_approved_application_list_hq',$data);
	}
	
	public function dist_rejected_application_list_in_hq()
	{
		$scheme_id = $this->uri->segment(4);
		$is_district_app_reject_revert = '2'; //rejected		
		$param_data = array('scheme_id'=>$scheme_id,'is_district_app_reject_revert'=>$is_district_app_reject_revert);
		
		$data['list']=$this->scheme_m->get_application_list($param_data);
		$this->load->view('headquater/dist_rejected_application_list_hq',$data);
	}
	
	public function dist_updated_application_list_in_hq()
	{
		$scheme_id = $this->uri->segment(4);
		$is_project_cost_updated_dist = '1'; //rejected
		$is_first_sanction  = '1'; //rejected
		
		$param_data = array('scheme_id'=>$scheme_id,'is_first_sanction'=>$is_first_sanction,'is_project_cost_updated_dist'=>$is_project_cost_updated_dist);
		
		$data['list']=$this->scheme_m->get_application_list($param_data);
		$this->load->view('headquater/dist_updated_application_list_hq',$data);
	}
	//Active Scheme List Function End
	
	
	
	public function citizen_form_details()
	{
		
		$application_id =$this->data['application_id']= $this->uri->segment('4'); //application_id
		$this->data['app_data'] = $this->admin_m->get_application_master_data($application_id);
		$this->data['industry_data']=$this->admin_m->get_industry_master_data('',$application_id);
		$this->data['pm_data']=$this->admin_m->get_plant_machinary_data($application_id);
		$this->data['document_upload_master_data'] = $this->admin_m->get_document_upload_master_data();
		//$this->data['document']=$this->admin_m->document_list($application_id);
		
		/*echo('<pre>');
		print_r($this->data);
		die();*/

		if(!empty($_POST))
        {
        	/*echo "<pre>";
        	print_r($_POST); die();*/
        	if(!empty($_POST['annexure1']) && $_POST["annexure1"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='1'");
                $district_remarks1 = $_POST['annexure1'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','1','$district_remarks1')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks1' WHERE file_application_id='$application_id' AND file_document_ms='1' ");
	              }

             }

            if(!empty($_POST['dpr']) && $_POST["dpr"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='2'");
                $district_remarks2 = $_POST['dpr'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','2','$district_remarks2')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks2' WHERE file_application_id='$application_id' AND file_document_ms='2' ");
	              }

             }
             
             if(!empty($_POST['sanction_letter_of_term_loan']) && $_POST["sanction_letter_of_term_loan"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='3'");
                $district_remarks3 = $_POST['sanction_letter_of_term_loan'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','3','$district_remarks3')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks3' WHERE file_application_id='$application_id' AND file_document_ms='3' ");
	              }

             }
    		if(!empty($_POST['appraisal_report']) && $_POST["appraisal_report"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='4'");
                $district_remarks4 = $_POST['appraisal_report'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','4','$district_remarks4')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks4' WHERE file_application_id='$application_id' AND file_document_ms='4' ");
	              }

             }

             if(!empty($_POST['certificate_of_incorporation']) && $_POST["certificate_of_incorporation"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='5'");
                $district_remarks5 = $_POST['certificate_of_incorporation'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','5','$district_remarks5')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks5' WHERE file_application_id='$application_id' AND file_document_ms='5' ");
	              }

             }
             if(!empty($_POST['memorandum_of_association']) && $_POST["memorandum_of_association"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='6'");
                $district_remarks6 = $_POST['memorandum_of_association'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','6','$district_remarks6')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks6' WHERE file_application_id='$application_id' AND file_document_ms='6' ");
	              }

             }
         	 if(!empty($_POST['partnership_deed']) && $_POST["partnership_deed"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='7'");
                $district_remarks7 = $_POST['partnership_deed'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','7','$district_remarks7')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks7' WHERE file_application_id='$application_id' AND file_document_ms='7' ");
	              }

             }
             if(!empty($_POST['bio_data']) && $_POST["bio_data"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='8'");
                $district_remarks8 = $_POST['bio_data'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','8','$district_remarks8')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks8' WHERE file_application_id='$application_id' AND file_document_ms='8' ");
	              }

             }

              if(!empty($_POST['annual_reports_audited_statement']) && $_POST["annual_reports_audited_statement"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='9'");
                $district_remarks9 = $_POST['annual_reports_audited_statement'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','9','$district_remarks9')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks9' WHERE file_application_id='$application_id' AND file_document_ms='9' ");
	              }

             }
             if(!empty($_POST['land_porcha']) && $_POST["land_porcha"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='10'");
                $district_remarks10 = $_POST['land_porcha'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','10','$district_remarks10')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks10' WHERE file_application_id='$application_id' AND file_document_ms='10' ");
	              }

             }

             if(!empty($_POST['blueprint_building_plan']) && $_POST["blueprint_building_plan"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='11'");
                $district_remarks11 = $_POST['blueprint_building_plan'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','11','$district_remarks11')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks11' WHERE file_application_id='$application_id' AND file_document_ms='11' ");
	              }

             }

             if(!empty($_POST['trade_licence']) && $_POST["trade_licence"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='12'");
                $district_remarks12 = $_POST['trade_licence'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','12','$district_remarks12')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks12' WHERE file_application_id='$application_id' AND file_document_ms='12' ");
	              }

             }

             if(!empty($_POST['land_deed']) && $_POST["land_deed"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='13'");
                $district_remarks13 = $_POST['land_deed'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','13','$district_remarks13')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks13' WHERE file_application_id='$application_id' AND file_document_ms='13' ");
	              }

             }

             if(!empty($_POST['certificate_of_item']) && $_POST["certificate_of_item"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='14'");
                $district_remarks14 = $_POST['certificate_of_item'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','14','$district_remarks14')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks14' WHERE file_application_id='$application_id' AND file_document_ms='14' ");
	              }

             }

             if(!empty($_POST['chartered_engineer']) && $_POST["chartered_engineer"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='15'");
                $district_remarks15 = $_POST['chartered_engineer'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','15','$district_remarks15')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks15' WHERE file_application_id='$application_id' AND file_document_ms='15' ");
	              }

             }
             if(!empty($_POST['quotations_of_prices']) && $_POST["quotations_of_prices"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='16'");
                $district_remarks16 = $_POST['quotations_of_prices'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','16','$district_remarks16')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks16' WHERE file_application_id='$application_id' AND file_document_ms='16' ");
	              }

             }

             if(!empty($_POST['marketing_strategy']) && $_POST["marketing_strategy"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='17'");
                $district_remarks17 = $_POST['marketing_strategy'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','17','$district_remarks17')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks17' WHERE file_application_id='$application_id' AND file_document_ms='17' ");
	              }

             }

             if(!empty($_POST['process_flow_diagram']) && $_POST["process_flow_diagram"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='18'");
                $district_remarks18 = $_POST['process_flow_diagram'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','18','$district_remarks18')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks18' WHERE file_application_id='$application_id' AND file_document_ms='18' ");
	              }

             }
             if(!empty($_POST['implementation_schedule']) && $_POST["implementation_schedule"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='19'");
                $district_remarks19 = $_POST['implementation_schedule'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','19','$district_remarks19')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks19' WHERE file_application_id='$application_id' AND file_document_ms='19' ");
	              }

             }
             if(!empty($_POST['submitted_affidavit']) && $_POST["submitted_affidavit"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='20'");
                $district_remarks20 = $_POST['submitted_affidavit'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','20','$district_remarks20')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks20' WHERE file_application_id='$application_id' AND file_document_ms='20' ");
	              }

             }
             if(!empty($_POST['submitted_bank_certificate']) && $_POST["submitted_bank_certificate"] !='')
            {
                $chk_data = $this->db->query("SELECT * FROM document_master WHERE file_application_id='$application_id' AND file_document_ms='21'");
                $district_remarks21 = $_POST['submitted_bank_certificate'];
              
	              if($chk_data->num_rows()==0)
	              {
	                $query = $this->db->query("INSERT INTO document_master(file_application_id,file_document_ms,district_remarks) VALUES('$application_id','21','$district_remarks21')");
	              }else{
	                $query = $this->db->query("UPDATE document_master SET district_remarks ='$district_remarks21' WHERE file_application_id='$application_id' AND file_document_ms='21' ");
	              }

             }

        }
		
		$this->load->view('admin/common_citizen_form_details_view',$this->data);
		//$this->load->view('pages/application_form_details',$data);
	}
	
	public function dist_updated_sanction_letter_details_in_hq()
	{

		$application_id =$this->data['application_id']= $this->uri->segment('4'); //application_id

		$this->data['app_data'] = $this->admin_m->get_application_master_data($application_id);
		$this->data['industry_data']=$this->admin_m->get_industry_master_data('',$application_id);
		$this->data['pm_data']=$this->admin_m->get_plant_machinary_data($application_id);
		$this->data['document_upload_master_data'] = $this->admin_m->get_document_upload_master_data();
		$this->data['document']=$this->admin_m->document_list($application_id);
		
		// print_r($data['document']);

		if(!empty($_POST))
        {
        	/*echo "<pre>";
        	print_r($_POST); die();*/

            $update_project_cost_by_dist = $this->input->post('update_project_cost_by_dist'); 
             
            if(!empty($_POST['update_project_cost_by_dist']) && $_POST["update_project_cost_by_dist"] !='')
            {
	            $query = $this->db->query("UPDATE application_master SET is_project_cost_updated_dist ='1',update_project_cost_by_dist='$update_project_cost_by_dist' WHERE application_id='$application_id'  ");

	            if($query ==true)
	            {
	            	$msg = "Project cost update";
	            }
             }
             $this->session->set_flashdata('msg',$msg);

        }
			
		$this->load->view('headquater/dist_updated_sanction_form_details_in_hq',$this->data);
	}
	
    
}
